{% extends 'common/base.html' %}
{% block title %}My Applications | DungeonFinder{% endblock %}

{% block content %}
<div class="my-applications-section">
    <div class="applications-tabs">
        <button class="btn tab-btn{% if view_type == 'received' %} active-tab{% endif %}"
                data-type="received">Received</button>
        <button class="btn tab-btn{% if view_type == 'sent' %} active-tab{% endif %}"
                data-type="sent">Sent</button>
    </div>
    <section class="ad-list" id="application-list">
        {% include 'ad_applications/_application_list.html' %}
    </section>
</div>
<script>
document.addEventListener('click', function(e) {
    const tab = e.target.closest('.tab-btn');
    const pageLink = e.target.closest('.pagination-link');

    if (tab) {
        // Toggle tab styles
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab'));
        tab.classList.add('active-tab');

        const type = tab.dataset.type;
        loadApplications(type, 1); // default to page 1 on tab switch
    }

    if (pageLink) {
        e.preventDefault();
        const type = pageLink.dataset.type;
        const page = pageLink.dataset.page;
        loadApplications(type, page);
    }
});

function loadApplications(type, page) {
    fetch(`/applications/my_applications/ajax/?type=${type}&page=${page}`)
        .then(response => response.json())
        .then(data => {
            document.getElementById('application-list').innerHTML = data.html;
        })
        .catch(error => {
            console.error('Error loading applications:', error);
            document.getElementById('application-list').innerHTML = '<p>Error loading data.</p>';
        });
}
</script>
{% endblock %}