{% extends 'common/base.html' %}
{% block title %}Create an Ad | DungeonFinder{% endblock %}

{% block content %}
<section class="ad-create-section">
    <div class="ad-block ad-create-block">
        <h1 class="ad-create-title">Create a New Ad</h1>
        <form method="post" class="ad-create-form">
            {% csrf_token %}
            {% if form.non_field_errors %}
                <div class="form-errors">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}

            <div class="form-row">
                <label for="{{ form.title.id_for_label }}">Title</label>
                {{ form.title }}
                {% if form.title.errors %}
                    <div class="form-errors">{{ form.title.errors }}</div>
                {% endif %}
            </div>
            <div class="form-row">
                <label for="{{ form.description.id_for_label }}">Description</label>
                {{ form.description }}
                {% if form.description.errors %}
                    <div class="form-errors">{{ form.description.errors }}</div>
                {% endif %}
            </div>
            <div class="form-row">
                <label>
                    {{ form.looking_for_dm }}
                    Looking for DM
                </label>
                <label>
                    {{ form.looking_for_players }}
                    Looking for players
                </label>
                {% if form.looking_for_dm.errors %}
                    <div class="form-errors">{{ form.looking_for_dm.errors }}</div>
                {% endif %}
                {% if form.looking_for_players.errors %}
                    <div class="form-errors">{{ form.looking_for_players.errors }}</div>
                {% endif %}
            </div>
            <div class="form-row" id="num-players-row">
                <label for="{{ form.num_players.id_for_label }}">Number of players wanted</label>
                {{ form.num_players }}
                {% if form.num_players.errors %}
                    <div class="form-errors">{{ form.num_players.errors }}</div>
                {% endif %}
            </div>
            <div class="form-row">
                <label for="{{ form.game_system.id_for_label }}">Game System</label>
                {{ form.game_system }}
                {% if form.game_system.errors %}
                    <div class="form-errors">{{ form.game_system.errors }}</div>
                {% endif %}
            </div>
            <div class="form-row">
                <label for="{{ form.session_frequency.id_for_label }}">Session Frequency</label>
                {{ form.session_frequency }}
                {% if form.session_frequency.errors %}
                    <div class="form-errors">{{ form.session_frequency.errors }}</div>
                {% endif %}
            </div>
            <div class="form-row">
                <label for="{{ form.location_type.id_for_label }}">Location Type</label>
                {{ form.location_type }}
                {% if form.location_type.errors %}
                    <div class="form-errors">{{ form.location_type.errors }}</div>
                {% endif %}
            </div>
            <div class="form-row">
                <label for="{{ form.location_details.id_for_label }}">Location Details</label>
                {{ form.location_details }}
                {% if form.location_details.errors %}
                    <div class="form-errors">{{ form.location_details.errors }}</div>
                {% endif %}
            </div>
            <div class="form-row">
                <label for="{{ form.tags.id_for_label }}">Tags (up to 5, comma separated)</label>
                {{ form.tags }}
                {% if form.tags.errors %}
                    <div class="form-errors">{{ form.tags.errors }}</div>
                {% endif %}
            </div>

            <div class="form-row">
                <label for="id_table_select">Choose table:</label>
                <select name="table" id="id_table_select">
                    <option value="" disabled {% if not form.table.value %}selected{% endif %}>-- Choose an option --</option>
                        {% for option in form.table.field.queryset %}
                            <option value="{{ option.pk }}"
                                {% if form.table.value|stringformat:"s" == option.pk|stringformat:"s" %}selected{% endif %}>
                                {{ option }}
                            </option>
                        {% endfor %}
                    <option value="__new__"
                        {% if form.table.value == "__new__" %}selected{% endif %}>
                        Create new table
                    </option>
                </select>
                {% if form.table.errors %}
                    <div class="form-errors">{{ form.table.errors }}</div>
                {% endif %}
            </div>

            <div id="new-table-fields" style="display:none;">
                <div class="form-row">
                    <label for="{{ form.new_table_name.id_for_label }}">New Table Group Name</label>
                    {{ form.new_table_name }}
                    {% if form.new_table_name.errors %}
                        <div class="form-errors">{{ form.new_table_name.errors }}</div>
                    {% endif %}
                </div>

            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-large">Create Ad</button>
            </div>
        </form>
    </div>
</section>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const lookingForPlayersCheckbox = document.getElementById('id_looking_for_players');
        const numPlayersRow = document.getElementById('num-players-row');
        function toggleNumPlayers() {
            if (lookingForPlayersCheckbox && numPlayersRow) {
                if (lookingForPlayersCheckbox.checked) {
                    numPlayersRow.style.display = '';
                } else {
                    numPlayersRow.style.display = 'none';
                }
            }
        }
        toggleNumPlayers();
        if (lookingForPlayersCheckbox) {
            lookingForPlayersCheckbox.addEventListener('change', toggleNumPlayers);
        }

        const tableSelect = document.getElementById('id_table_select');
        const newTableFields = document.getElementById('new-table-fields');
        function toggleNewTableFields() {
            if (tableSelect) {
                if (tableSelect.value === '__new__') {
                    newTableFields.style.display = '';
                } else {
                    newTableFields.style.display = 'none';
                }
            }
        }
        toggleNewTableFields();
        if (tableSelect) {
            tableSelect.addEventListener('change', toggleNewTableFields);
        }
    });
</script>
{% endblock %}